<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   viewBox="0 0 1200 900"
   width="1200"
   height="900"
   version="1.1"
   id="svg63"
   sodipodi:docname="neural_logic_diagram.svg"
   inkscape:version="1.4.2 (ebf0e94, 2025-05-08)"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
  <sodipodi:namedview
     id="namedview63"
     pagecolor="#ffffff"
     bordercolor="#000000"
     borderopacity="0.25"
     inkscape:showpageshadow="2"
     inkscape:pageopacity="0.0"
     inkscape:pagecheckerboard="0"
     inkscape:deskcolor="#d1d1d1"
     inkscape:zoom="0.8175"
     inkscape:cx="600"
     inkscape:cy="449.54128"
     inkscape:window-width="1080"
     inkscape:window-height="1897"
     inkscape:window-x="0"
     inkscape:window-y="0"
     inkscape:window-maximized="1"
     inkscape:current-layer="svg63" />
  <!-- Title -->
  <text
     x="600"
     y="30"
     font-size="20"
     font-weight="bold"
     text-anchor="middle"
     fill="#333"
     id="text1">
    Neural Logic Auto-Encoder Architecture: Data Flow
  </text>
  <!-- Layer labels on the left -->
  <text
     x="20"
     y="120"
     font-size="14"
     font-weight="bold"
     fill="#666"
     id="text2">INPUT</text>
  <text
     x="20"
     y="260"
     font-size="14px"
     font-weight="bold"
     fill="#666666"
     id="text3">LAYER 1</text>
  <text
     x="20"
     y="280"
     font-size="11"
     fill="#666"
     id="text4">Ground</text>
  <text
     x="20"
     y="295"
     font-size="11"
     fill="#666"
     id="text5">Predicates</text>
  <text
     x="20"
     y="460"
     font-size="14px"
     font-weight="bold"
     fill="#666666"
     id="text6">LAYER 2</text>
  <text
     x="20"
     y="480"
     font-size="11"
     fill="#666"
     id="text7">Patterns</text>
  <text
     x="20"
     y="630"
     font-size="14px"
     font-weight="bold"
     fill="#666666"
     id="text8">LAYER 3</text>
  <text
     x="20"
     y="650"
     font-size="11"
     fill="#666"
     id="text9">Rules</text>
  <text
     x="20"
     y="820"
     font-size="14"
     font-weight="bold"
     fill="#666"
     id="text10">OUTPUT</text>
  <!-- INPUT LAYER -->
  <rect
     x="150"
     y="80"
     width="744.64832"
     height="86.116211"
     fill="#e3f2fd"
     stroke="#1976d2"
     stroke-width="2"
     rx="5"
     id="rect10" />
  <text
     x="600"
     y="105"
     font-size="14"
     font-weight="bold"
     text-anchor="middle"
     fill="#1565c0"
     id="text11">
    Board State: (batch, 9, 3) one-hot [empty, X, O]
  </text>
  <text
     x="600"
     y="130"
     font-size="12"
     text-anchor="middle"
     fill="#444"
     id="text12">
    Example: position 0 = [1,0,0] (empty), position 1 = [0,1,0] (X), position 2 = [0,0,1] (O)
  </text>
  <!-- Arrow from input to Layer 1 -->
  <path
     d="M 600 160 L 600 200"
     stroke="#333"
     stroke-width="2"
     fill="none"
     marker-end="url(#arrowhead)"
     id="path12" />
  <!-- LAYER 1: Ground Predicates -->
  <g
     id="layer1">
    <!-- Left box: Position encoding -->
    <rect
       x="150"
       y="210"
       width="250"
       height="140"
       fill="#fff3e0"
       stroke="#f57c00"
       stroke-width="2"
       rx="5"
       id="rect12" />
    <text
       x="275"
       y="230"
       font-size="13"
       font-weight="bold"
       text-anchor="middle"
       fill="#e65100"
       id="text13">
      Position Encoder
    </text>
    <text
       x="275"
       y="250"
       font-size="11"
       text-anchor="middle"
       fill="#666"
       id="text14">
      Embedding(9 → 16)
    </text>
    <text
       x="275"
       y="270"
       font-size="10"
       text-anchor="middle"
       fill="#444"
       id="text15">
      Maps position index
    </text>
    <text
       x="275"
       y="285"
       font-size="10"
       text-anchor="middle"
       fill="#444"
       id="text16">
      0..8 to learned vectors
    </text>
    <rect
       x="160"
       y="300"
       width="230"
       height="40"
       fill="#ffe0b2"
       stroke="#f57c00"
       stroke-width="1"
       rx="3"
       id="rect16" />
    <text
       x="275"
       y="325"
       font-size="10"
       font-family="monospace"
       text-anchor="middle"
       id="text17">
      pos_enc: (batch, 9, 16)
    </text>
    <!-- Middle box: Positional predicates -->
    <rect
       x="420"
       y="210"
       width="180"
       height="140"
       fill="#fff3e0"
       stroke="#f57c00"
       stroke-width="2"
       rx="5"
       id="rect17" />
    <text
       x="510"
       y="230"
       font-size="13"
       font-weight="bold"
       text-anchor="middle"
       fill="#e65100"
       id="text18">
      Position Predicates
    </text>
    <text
       x="510"
       y="250"
       font-size="10"
       text-anchor="middle"
       fill="#444"
       id="text19">
      3 × Linear(16 → 1) + σ
    </text>
    <rect
       x="430"
       y="265"
       width="160"
       height="18"
       fill="#ffe0b2"
       stroke="#f57c00"
       stroke-width="1"
       rx="3"
       id="rect19" />
    <text
       x="510"
       y="278"
       font-size="9"
       font-family="monospace"
       text-anchor="middle"
       id="text20">is_corner: (batch,9,1)</text>
    <rect
       x="430"
       y="287"
       width="160"
       height="18"
       fill="#ffe0b2"
       stroke="#f57c00"
       stroke-width="1"
       rx="3"
       id="rect20" />
    <text
       x="510"
       y="300"
       font-size="9"
       font-family="monospace"
       text-anchor="middle"
       id="text21">is_center: (batch,9,1)</text>
    <rect
       x="430"
       y="309"
       width="160"
       height="18"
       fill="#ffe0b2"
       stroke="#f57c00"
       stroke-width="1"
       rx="3"
       id="rect21" />
    <text
       x="510"
       y="322"
       font-size="9"
       font-family="monospace"
       text-anchor="middle"
       id="text22">is_edge: (batch,9,1)</text>
    <!-- Right box: State predicates -->
    <rect
       x="620"
       y="210"
       width="250"
       height="140"
       fill="#fff3e0"
       stroke="#f57c00"
       stroke-width="2"
       rx="5"
       id="rect22" />
    <text
       x="745"
       y="230"
       font-size="13"
       font-weight="bold"
       text-anchor="middle"
       fill="#e65100"
       id="text23">
      State Predicates
    </text>
    <text
       x="745"
       y="250"
       font-size="10"
       text-anchor="middle"
       fill="#444"
       id="text24">
      Linear(19 → 32) + tanh
    </text>
    <text
       x="745"
       y="270"
       font-size="10"
       text-anchor="middle"
       fill="#666"
       id="text25">
      Input: [pos_enc, state]
    </text>
    <text
       x="745"
       y="285"
       font-size="9"
       text-anchor="middle"
       fill="#666"
       id="text26">
      (16 + 3 dimensions)
    </text>
    <rect
       x="630"
       y="300"
       width="230"
       height="40"
       fill="#ffe0b2"
       stroke="#f57c00"
       stroke-width="1"
       rx="3"
       id="rect26" />
    <text
       x="745"
       y="325"
       font-size="10"
       font-family="monospace"
       text-anchor="middle"
       id="text27">
      state_features: (batch, 9, 32)
    </text>
  </g>
  <!-- Arrows from Layer 1 to Layer 2 -->
  <path
     d="M 275 350 L 275 410"
     stroke="#333"
     stroke-width="2"
     fill="none"
     marker-end="url(#arrowhead)"
     id="path27" />
  <path
     d="M 745 350 L 745 410"
     stroke="#333"
     stroke-width="2"
     fill="none"
     marker-end="url(#arrowhead)"
     id="path28" />
  <!-- LAYER 2: Pattern Recognition -->
  <g
     id="layer2">
    <rect
       x="150"
       y="420"
       width="700"
       height="120"
       fill="#f3e5f5"
       stroke="#7b1fa2"
       stroke-width="2"
       rx="5"
       id="rect28" />
    <text
       x="500"
       y="440"
       font-size="13"
       font-weight="bold"
       text-anchor="middle"
       fill="#6a1b9a"
       id="text28">
      Line Pattern Detector (processes 8 winning lines)
    </text>
    <!-- Show the process for one line -->
    <rect
       x="170"
       y="455"
       width="320"
       height="75"
       fill="#e1bee7"
       stroke="#7b1fa2"
       stroke-width="1"
       rx="3"
       id="rect29" />
    <text
       x="330"
       y="472"
       font-size="11"
       font-weight="bold"
       text-anchor="middle"
       fill="#4a148c"
       id="text29">
      For each line (e.g., [0,1,2]):
    </text>
    <text
       x="330"
       y="490"
       font-size="10"
       text-anchor="middle"
       fill="#444"
       id="text30">
      1. Extract: state_features[:, [0,1,2], :] → (batch, 3, 32)
    </text>
    <text
       x="330"
       y="505"
       font-size="10"
       text-anchor="middle"
       fill="#444"
       id="text31">
      2. Flatten: → (batch, 96)
    </text>
    <text
       x="330"
       y="520"
       font-size="10"
       text-anchor="middle"
       fill="#444"
       id="text32">
      3. NN: Linear(96→64)→ReLU→Linear(64→32)
    </text>
    <!-- Aggregation -->
    <rect
       x="510"
       y="455"
       width="320"
       height="75"
       fill="#e1bee7"
       stroke="#7b1fa2"
       stroke-width="1"
       rx="3"
       id="rect32" />
    <text
       x="670"
       y="472"
       font-size="11"
       font-weight="bold"
       text-anchor="middle"
       fill="#4a148c"
       id="text33">
      Aggregate all 8 lines:
    </text>
    <text
       x="670"
       y="490"
       font-size="10"
       text-anchor="middle"
       fill="#444"
       id="text34">
      Stack: (batch, 8, 32)
    </text>
    <text
       x="670"
       y="505"
       font-size="10"
       text-anchor="middle"
       fill="#444"
       id="text35">
      Flatten: (batch, 256)
    </text>
    <text
       x="670"
       y="520"
       font-size="10"
       text-anchor="middle"
       fill="#444"
       id="text36">
      NN: Linear(256→64)→ReLU → (batch, 64)
    </text>
  </g>
  <!-- Arrow from Layer 2 to Layer 3 -->
  <path
     d="M 500 540 L 500 580"
     stroke="#333"
     stroke-width="2"
     fill="none"
     marker-end="url(#arrowhead)"
     id="path36" />
  <text
     x="520"
     y="565"
     font-size="10"
     fill="#666"
     id="text37">aggregated_patterns: (batch, 64)</text>
  <!-- LAYER 3: Rule Network -->
  <g
     id="layer3">
    <rect
       x="150"
       y="590"
       width="700"
       height="100"
       fill="#e8f5e9"
       stroke="#388e3c"
       stroke-width="2"
       rx="5"
       id="rect37" />
    <text
       x="500"
       y="610"
       font-size="13"
       font-weight="bold"
       text-anchor="middle"
       fill="#2e7d32"
       id="text38">
      Rule Network: Combines global patterns with local position info
    </text>
    <text
       x="500"
       y="635"
       font-size="10"
       text-anchor="middle"
       fill="#444"
       id="text39">
      For each position: concat([aggregated_patterns, state_features[i], board_state[i]])
    </text>
    <text
       x="500"
       y="655"
       font-size="10"
       text-anchor="middle"
       fill="#444"
       id="text40">
      Input per position: (64 + 32 + 3) = 99 dimensions
    </text>
    <text
       x="500"
       y="675"
       font-size="10"
       text-anchor="middle"
       fill="#444"
       id="text41">
      NN: Linear(99→64)→ReLU→Linear(64→64)→ReLU → rule_activations: (batch, 9, 64)
    </text>
  </g>
  <!-- Arrow from Layer 3 to Output -->
  <path
     d="M 500 690 L 500 750"
     stroke="#333"
     stroke-width="2"
     fill="none"
     marker-end="url(#arrowhead)"
     id="path41" />
  <!-- OUTPUT LAYER -->
  <g
     id="output">
    <rect
       x="150"
       y="760"
       width="700"
       height="100"
       fill="#ffebee"
       stroke="#c62828"
       stroke-width="2"
       rx="5"
       id="rect41" />
    <text
       x="500"
       y="780"
       font-size="13"
       font-weight="bold"
       text-anchor="middle"
       fill="#b71c1c"
       id="text42">
      Next State Predictor
    </text>
    <text
       x="500"
       y="805"
       font-size="10"
       text-anchor="middle"
       fill="#444"
       id="text43">
      For each position: Linear(64 → 3) applied to rule_activations
    </text>
    <text
       x="500"
       y="825"
       font-size="10"
       text-anchor="middle"
       fill="#444"
       id="text44">
      Output: logits (batch, 9, 3) → softmax → probabilities for [empty, X, O]
    </text>
    <text
       x="500"
       y="845"
       font-size="11"
       font-weight="bold"
       text-anchor="middle"
       fill="#b71c1c"
       id="text45">
      Final: Predicted next board state
    </text>
  </g>
  <!-- Side annotation: Information flow -->
  <g
     id="annotations"
     transform="translate(4,8)">
    <text
       x="920"
       y="140"
       font-size="12px"
       font-weight="bold"
       fill="#1976d2"
       id="text46">Information Flow:</text>
    <text
       x="920"
       y="165"
       font-size="10px"
       fill="#444444"
       id="text47">• Each position gets encoding</text>
    <text
       x="920"
       y="185"
       font-size="10px"
       fill="#444444"
       id="text48">• Positional predicates computed</text>
    <text
       x="920"
       y="205"
       font-size="10px"
       fill="#444444"
       id="text49">(corner/center/edge)</text>
    <text
       x="920"
       y="450"
       font-size="10px"
       fill="#444444"
       id="text50">• Lines analyzed separately</text>
    <text
       x="920"
       y="470"
       font-size="10px"
       fill="#444444"
       id="text51">• Patterns aggregated globally</text>
    <text
       x="920"
       y="630"
       font-size="10px"
       fill="#444444"
       id="text52">• Global patterns broadcast</text>
    <text
       x="920"
       y="650"
       font-size="10px"
       fill="#444444"
       id="text53">to all positions</text>
    <text
       x="920"
       y="670"
       font-size="10px"
       fill="#444444"
       id="text54">• Combined with local info</text>
    <text
       x="920"
       y="800"
       font-size="10px"
       fill="#444444"
       id="text55">• Independent prediction</text>
    <text
       x="920"
       y="820"
       font-size="10px"
       fill="#444444"
       id="text56">for each position</text>
  </g>
  <!-- Legend for what "logic" means here -->
  <g
     id="legend"
     transform="translate(-2.4464832,-8.5626911)">
    <rect
       x="900"
       y="250"
       width="280"
       height="140"
       fill="#fafafa"
       stroke="#999999"
       stroke-width="1"
       rx="5"
       id="rect56" />
    <text
       x="1040"
       y="270"
       font-size="12px"
       font-weight="bold"
       text-anchor="middle"
       fill="#333333"
       id="text57">&quot;Logic&quot; Implementation</text>
    <text
       x="910"
       y="295"
       font-size="10px"
       fill="#444444"
       id="text58">Predicate = NN output ∈ [0,1]</text>
    <text
       x="910"
       y="315"
       font-size="10px"
       fill="#444444"
       id="text59">σ(Linear(...)) gives fuzzy truth value</text>
    <text
       x="910"
       y="340"
       font-size="10px"
       fill="#444444"
       id="text60">Pattern = Learned feature detector</text>
    <text
       x="910"
       y="360"
       font-size="10px"
       fill="#444444"
       id="text61">NN learns to recognize &quot;two-in-a-row&quot;</text>
    <text
       x="910"
       y="380"
       font-size="10px"
       fill="#444444"
       id="text62">Rule = Decision function</text>
    <text
       x="910"
       y="400"
       font-size="10px"
       fill="#444444"
       id="text63">Combines patterns → action preference</text>
  </g>
  <!-- Arrow marker definition -->
  <defs
     id="defs63">
    <marker
       id="arrowhead"
       markerWidth="10"
       markerHeight="10"
       refX="9"
       refY="3"
       orient="auto">
      <polygon
         points="0 0, 10 3, 0 6"
         fill="#333"
         id="polygon63" />
    </marker>
  </defs>
</svg>
